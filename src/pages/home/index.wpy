<style lang="less">
@import "../../style/home.less";
page {
  overflow: hidden;
}
.detail-view {
  height: 100%;
  overflow: hidden;
  .page_margin {
    margin: 24rpx 24rpx 0;
  }
  .header-box {
    background: #ffffff;
    height: 90rpx;
    font-size: 24rpx;
    padding: 0 26rpx;
    .search-box {
      border: 1px solid #eee;
      width: 23%;
      height: 48rpx;
      border-radius: 30rpx;
      padding: 4rpx 20rpx 0;
      transition: 1s;
      .searchIcon {
        height: 24rpx;
        width: 25rpx;
      }
      .search-input {
        padding: 0 0 0 10rpx;
      }
    }
  }
  .view-detail {
    height: calc(100% - 108px);
    overflow: auto;
  }
  .status-row {
    position: absolute;
    top: 90rpx;
    left: 28%;
    background: #fff;
    z-index: 233;
    .status-item {
      width: 220rpx;
      height: 58rpx;
      color: #6a6a6a;
      font-size: 26rpx;
      border-radius: 5rpx;
      overflow: hidden;
      text-align: center;
      line-height: 58rpx;
      border-bottom: 1px solid #eee;
      &.status-item-active {
        background: #1890ff;
        color: #fff;
      }
    }
  }
}
</style>
<template>
  <view class="home-view detail-view">
        <view class="weui-flex between header-box">
          <tabBar :tabBarList.sync="tabBarList" 
          wx:if="{{!isSeachWidth}}" @switchTab="switchTab"></tabBar>
          <search class="search-box {{isSeachWidth?'weui-flex__item':''}}" 
			   @searchValue="searchValue">
			</search>
		</view>
    <view class="page_margin view-content">
      <scroll-view scroll-y="true"  style="height:100%" @scrolltolower="searchScrollLower">
        <resumeList :list.sync="list" @applyResume="applyResume"></resumeList>
      </scroll-view>
    </view>
      <view class="home-add-resume" @tap="addResume">
        <image src="https://a.rsd123.com/image/images/add.png" class="add-icon" />
        <view class="home-add-text">添加简历</view>
      </view>
      <selectModal :isScaleModal.sync="isSelectModal" :menus.sync="menus" :title.sync="modalTitle" ></selectModal>
      <view class="status-row" wx:if="{{isStatus}}">
         <repeat wx:for="{{statusList}}" wx:key="index">
            <view class="status-item {{statusIndex==index?'status-item-active':''}}" @tap="selectStatus({{item}},{{index}})">{{item.label}}</view>
          </repeat>
      </view>
  </view>
</template>
<script>
import wepy from 'wepy'
import { $http } from '@/http.js'
import resumeList from '@/components/resumeList'
import tabBar from '@/components/tabBar'
import search from '@/components/search'
import selectModal from '@/components/selectModal'
import { wxNavigateTo } from '@/util.js'
export default class home extends wepy.page {
  components = {
    tabBar: tabBar,
    search: search,
    resumeList: resumeList,
    selectModal: selectModal
  }
  data = {
    list: [],
    tabBarList: [
      { name: '全部简历', num: 0 },
      { name: '待审核', num: 0 },
      { name: '已通过', num: 0 },
      { name: '未入职', num: 0 }],
    params: {
      uid: '',
      page: 1,
      limit: 10
    },
    statusList: [
      {
        label: '初筛已通过',
        value: 1
      },
      {
        label: '面试已通过',
        value: 2
      },
      {
        label: '(内)出筛已通过',
        value: 1
      },
      {
        label: '(外)出筛已通过',
        value: 1
      }
    ],
    count: 0,
    activeIndex: 0,
    isSeachWidth: false,
    isSelectModal: true,
    modalTitle: '请选择岗位性质',
    menus: [
      {
        icon: '../../images/modal/icon3.png',
        title: '内部发单',
      },
      {
        icon: '../../images/modal/icon4.png',
        title: '团队接单'
      }
    ],
    statusIndex: 0,
    isStatus: false
  }
  events = {
    searchValue: val => {
      this.params = Object.assign(this.params, { where: val })
      this.getResumeList()
    },
    inputFocus: () => {
      this.isSeachWidth = true
      this.$apply()
    },
    applyResume: data => {
      this.isSelectModal = false
      this.$apply()
    },
    switchTab: val => {
      if (val === 2) {
        this.isStatus = true
        this.$apply()
      } else {
        this.getResumeList()
      }
    }
  }
  methods = {
    addResume() {
      wxNavigateTo('/pages/home/addInfo')
    },
    searchScrollLower() {
      if (this.count > this.list.length && this.count > this.params.limit) {
        this.params.limit = this.params.limit + 10
        this.getResumeList()
      }
    },
    selectStatus(item, index) {
      this.statusIndex = index
      this.getResumeList()
      this.$apply()
      console.log(item)
    }
  }
  getResumeList() {
    $http('/Wxresume/resumelist', this.params).then(res => {
      this.list = res.data.data || []
      this.count = res.data.count
      this.isStatus = false
      this.$apply()
    })
  }
  onLoad() {
    this.params.uid = wx.getStorageSync('rendaUid') || this.$parent.globalData.uid
  }
  onShow() {
    this.getResumeList()
  }
}
</script>